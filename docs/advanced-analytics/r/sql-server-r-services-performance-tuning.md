---
title: SQL Server R Services のパフォーマンス チューニング - SQL Server Machine Learning サービス
ms.prod: sql
ms.technology: machine-learning
ms.date: 04/15/2018
ms.topic: conceptual
author: dphansen
ms.author: davidph
manager: cgronlun
ms.openlocfilehash: e547e2cd3c50e020d1164dc2b8aaffb31f4e3cb8
ms.sourcegitcommit: f7fced330b64d6616aeb8766747295807c92dd41
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "62641656"
---
# <a name="performance-tuning-for-r-in-sql-server"></a>SQL Server で R のパフォーマンス チューニング
[!INCLUDE[appliesto-ss-xxxx-xxxx-xxx-md-winonly](../../includes/appliesto-ss-xxxx-xxxx-xxx-md-winonly.md)]

この記事では、一連の 2 つのケース スタディに基づいて、R Services のパフォーマンスの最適化を説明する 4 つの記事の 1 つ目です。

- R ソリューションのパフォーマンス プロファイルを検証する、製品開発チームによって実施されるパフォーマンス テスト

- 多くの場合、お客様から要求された特定の機械学習のシナリオには、Microsoft データ サイエンス チームによってパフォーマンスを最適化します。

このシリーズの目的は、パフォーマンス チューニングは、SQL Server で R ジョブを実行するために最も便利な手法の種類についてのガイダンスを提供します。

+ (最初の) このトピックでは、データ サイエンス タスクを最適化するときに、アーキテクチャと一般的な問題の概要を示します。
+ 2 番目の記事では、特定のハードウェアおよび SQL Server の最適化について説明します。
+ 3 番目の記事では、R コードと運用化するためのリソースでの最適化について説明します。
+ 4 番目の記事には、テスト メソッドの詳細とレポートの結果と結論がについて説明します。

**適用対象:** SQL Server 2016 R Services、SQL Server 2017 の Machine Learning サービス

## <a name="performance-goals-and-targeted-scenarios"></a>パフォーマンス目標、および対象となるシナリオ

R Services の機能は、SQL Server で R スクリプトの実行をサポートする SQL Server 2016 で導入されました。 この機能を使用するときに、R ランタイムは、データベース エンジンの個別のプロセスで動作しますが、Trusted Launchpad などの SQL サーバーとサーバーのリソースと対話するサービスを使用して、データベース エンジンとデータを安全に交換します。

SQL Server 2017 では将来的に実行する追加の言語で同じのアーキテクチャを使用して Python スクリプトを実行するためのサポートが発表されました。

データベース管理者とデータベース アーキテクトは machine learning のジョブのためのリソースの競合が発生する可能性を意識していると、サポートするためにサーバーを構成することが重要です。 サポートされているバージョンと言語の数が増えると、新しいワークロード。 安全でないデータ移動を回避できますが、データの近くで分析を維持する方法、分析ワークロードとデータをホストするサーバーに戻すには、データ サイエンティストのラップトップ コンピューター オフも移動します。

明らかに、machine learning のパフォーマンスの最適化は画一的な提案ではありません。 次の一般的なタスクには、非常にさまざまなパフォーマンス プロファイルがあります。

- タスクのトレーニング: を作成して、ニューラル ネットワークのトレーニングと回帰モデルのトレーニング
- T-SQL を使用して特徴の抽出と R を使用して特徴エンジニア リング
- 1 行または表形式の入力を使用してスコア付け一括と、小さなバッチでのスコアリング
- R でのストアド プロシージャでの SQL Server の運用環境にモデルの配置とスコア付けを実行しています。
- データ転送を最小限に抑えるか、コストの高いデータの変換を削除する R コードを変更します。
- 自動テストとモデルの再トレーニングを有効にします。

最適化手法の選択は、タスクは、アプリケーションやユース ケースにとって重要に依存するため、ケース スタディは、全般的なパフォーマンスのヒントと、特定のシナリオ、バッチ スコアリングのための最適化を最適化する方法に関するガイダンスの両方を取り上げます。

+ **SQL Server での個々 の最適化オプション**

    最初のパフォーマンスのケース スタディ、複数のテストがモデルの 1 つの型を使用して 1 つのデータセットで実行します。 モデルを構築し、そこからスコアを作成に使用された revoscaler rxLinMod アルゴリズムが、コードだけではなく、基になるデータ テーブルが各変更の影響をテストする体系的に変更されました。

    たとえば、1 つテストの実行で R コードが変更されました機能を事前に計算をテーブルから機能を読み込むと、変換関数を使用して特徴エンジニア リングとの間の比較を持たせてように。 別のテストの実行、モデル トレーニングのパフォーマンスが標準のインデックス付きテーブルとデータの比較を使用して、さまざまな種類の圧縮または新しいインデックスの種類を持つテーブルでの間で比較されます。

+ **特定の高ボリューム スコアリング シナリオの最適化**

    2 番目のケース スタディで機械学習タスクでは、複数の位置に対して送信され、各ジョブの位置の最適な候補を検索、多くの再開を処理する必要があります。 二項分類問題として、machine learning モデル自体の作成: 入力として、resume およびジョブの説明の受け取りをジョブの再開の各ペアの確率が生成されます。 目標は、最適な一致を検索すること、ため、ユーザー定義の確率のしきい値を使用して、さらにフィルター処理し、適切な一致だけを取得します。

    このソリューションでの主な目的は、スコア付け中に、低待機時間を実現するためにしました。 ただし、このタスクは、新しい各ジョブは、何百万もの妥当な期間内で再開に対して一致する必要があるため、スコア付けプロセス中にも負荷は。 さらに、機能エンジニア リング手順では、再開またはジョブごとの 2,000 台以上の機能を生成し、大幅なパフォーマンスのボトルネックとなっています。

最初のケース スタディを決定する手法は、ソリューションに適用可能なすべての結果を確認し、潜在的な影響を比較検討することをお勧めします。

次に、作成者のさまざまな手法を適用して、特定のワークロードをサポートするためにサーバーを最適化してスコア付けの最適化のケース スタディの結果を確認します。

## <a name="performance-optimization-process"></a>パフォーマンスの最適化プロセス

構成とパフォーマンスのチューニングは、特定のワークロード用に設計されたレイヤー最適化する確実な基盤を作成する必要があります。

- ホストの analytics への適切なサーバーを選択します。 通常、セカンダリ レポート、データ ウェアハウスまたはその他のレポートまたは分析のために既に使用されている他のサーバーをお勧めします。 ただし、ハイブリッド トランザクション分析処理 (HTAP) ソリューションでは、オペレーション データできます R への入力として高速のスコア付けします。

- 分散データベース エンジンの操作と R に SQL Server インスタンスを構成または Python スクリプトの適切なレベルで実行します。 これは、メモリと CPU の使用状況、NUMA とプロセッサのアフィニティ設定、およびリソース グループの作成の SQL Server の既定値の変更を含めることができます。

- 外部スクリプトの効率的な使用をサポートするために、サーバー コンピューターを最適化します。 これは、パッケージの管理を有効にすると、外部スクリプト実行するために使用されるアカウントの数を増やすことを含めることができ、ユーザーの割り当てに関連するセキュリティ ロール。

- データ ストレージとインデックス作成など、SQL Server と統計戦略、クエリのデザインとクエリの最適化、および機械学習に使用されるテーブルの設計で転送するには、特定の最適化を適用します。 データ ソースを分析することも、データ トランスポートのメソッド、または特徴の抽出を最適化するために、ETL プロセスを変更します。

- 非効率性を回避するために分析モデルを調整します。 可能な最適化のスコープは、R コードと、パッケージとデータを使用しているの複雑さによって異なります。 重要なタスクには、コストの高いデータの変換を削除するか、タスクをオフロードするデータの準備や機能エンジニア リングから R または Python を ETL プロセスまたは SQL が含まれます。 可能性がありますもスクリプトをリファクタリング、インラインでのパッケージのインストールを排除、トレーニング、スコア付け、および評価、別々 のプロシージャに R コードを分割またはストアド プロシージャより効率的に作業コードを簡略化します。

## <a name="articles-in-this-series"></a>このシリーズの記事

+ [SQL Server のハードウェアでの R のパフォーマンス チューニング](../r/sql-server-configuration-r-services.md)

    ハードウェアを構成するためのガイダンスを提供する[!INCLUDE[ssNoVersion_md](../../includes/ssnoversion-md.md)]と外部スクリプトのサポートを強化する SQL Server インスタンスを構成するためがインストールされています。 これは特に役立ちます**データベース管理者**します。

+ [SQL Server のコードとデータでの R のパフォーマンス チューニングの最適化](../r/r-and-data-optimization-r-services.md)

    既知の問題を回避するために外部のスクリプトを最適化する方法についての特別なヒントを提供します。 これが最も役に立つ**データ サイエンティスト**します。

    > [!NOTE]
    > R、一般にはこのセクションの情報の多くは、いくつかの情報は、RevoScaleR 分析関数に固有です。 詳細なパフォーマンスのガイダンスは利用できません**revoscalepy**し、その他の Python ライブラリがサポートされています。
    >

+ [SQL Server - メソッドと結果での R のパフォーマンス チューニング](../r/performance-case-study-r-services.md)

    まとめたものです、2 つのケース スタディ、パフォーマンスのテスト方法と、最適化が結果に影響をどのようなデータが使用されます。
