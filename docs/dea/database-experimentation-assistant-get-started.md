---
title: Database Experimentation Assistant を使ってみる
description: Database Experimentation Assistant (DEA) は、アップグレードや新しいインデックスなど、SQL Server 環境で変更を行うための A/B テストソリューションです。
ms.date: 10/22/2018
ms.prod: sql
ms.prod_service: dea
ms.suite: sql
ms.technology: dea
ms.tgt_pltfrm: ''
ms.topic: conceptual
author: HJToland3
ms.author: ajaykar
ms.reviewer: mathoma
ms.custom: seo-lt-2019
ms.openlocfilehash: 43f8c6bff909716bdd85a798dfd4e5a7431e31af
ms.sourcegitcommit: d00ba0b4696ef7dee31cd0b293a3f54a1beaf458
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/13/2019
ms.locfileid: "74056714"
---
# <a name="get-started-with-database-experimentation-assistant-sql-server"></a>Database Experimentation Assistant (SQL Server) を使ってみる

Database Experimentation Assistant (DEA) は、アップグレードや新しいインデックスなど、SQL Server 環境で変更を行うための A/B テストソリューションです。 DEA は、新しい環境でソースサーバー (現在の環境で) のワークロードがどのように動作するかを評価するのに役立ちます。 次の3つの手順を実行して A/B テストを実行する手順について説明します。 

- キャプチャ
- 反射
- 分析

この記事では、これらの手順について説明します。

## <a name="capture"></a>キャプチャ

A/B テスト SQL Server の最初の手順は、移行元サーバーでトレースをキャプチャすることです。 通常、移行元サーバーは運用サーバーです。 トレースファイルは、タイムスタンプを含む、そのサーバー上のクエリワークロード全体をキャプチャします。 このトレースは、後で対象サーバーで分析のために再生されます。 分析レポートは、2つの対象サーバー間のワークロードのパフォーマンスの違いに関する洞察を提供します。

注意点 :

- トレースキャプチャを開始する前に、トレースをキャプチャしているデータベースを必ずバックアップしてください。
- DEA ユーザーは、Windows 認証を使用してデータベースに接続するように構成する必要があります。
- SQL Server サービスアカウントには、ソーストレースファイルのパスへのアクセス権が必要です。
- DEA でクエリのパフォーマンスが向上したか低下しているかを判断するには、そのクエリがキャプチャ期間中に少なくとも15回実行される必要があります。  

移行元サーバーでトレースをキャプチャするには、次のようにします。

1. DEA で、左側のメニューの カメラ アイコンを選択して、**すべてのキャプチャ** に移動します。

   ![左側のナビゲーションメニュー](./media/database-experimentation-assistant-get-started/dea-get-started-leftnav.png)

1. 次の情報を入力または選択します。

   - **トレース名**: 作成中の新しいトレースファイルのファイル名。 ロールオーバーファイルの名前付け規則 (たとえば、CaptureName\_NNN) を使用するトレース名は避けてください。
   - **Duration**: キャプチャの期間。
   - **SQL Server インスタンス名**: トレースをキャプチャする SQL Server インスタンス。
   - **データベース名**: トレースをキャプチャする SQL Server を実行しているコンピューター上のデータベースの名前。 空のままにすると、サーバー上のすべてのデータベースからトレースがキャプチャされます。
   - **SQL Server マシンにソーストレースファイルを格納するパス**: トレースファイルを保存するフォルダーのパス。

1. ターゲットデータベースがバックアップされていることを確認します。 次に、[データベース] チェックボックスをオンにします。
1. **[開始]** を選択してキャプチャを開始します。

開始時刻、期間、残り時間など、キャプチャの進行状況を表示できます。 このキャプチャが終了するまで待機している間に、新しいキャプチャを開始することもできます。 キャプチャが完了したら、出力トレースファイルを使用して、2番目のフェーズを開始します。対象サーバーでトレースファイルを再生します。

トレースキャプチャに関してよく寄せられる質問については、「キャプチャに関する[FAQ](database-experimentation-assistant-capture-trace.md#frequently-asked-questions-about-trace-capture)」を参照してください。

## <a name="replay"></a>反射

A/B テストを SQL Server する2番目の手順では、対象サーバーにキャプチャされたトレースファイルを再生します。 次に、再生の分析から広範なトレースを収集します。 

2つの対象サーバーでトレースファイルを再生します。1つは移行元サーバーを模倣したサーバー (ターゲット 1)、もう1つは提案された変更 (ターゲット 2) を模倣したものです。 ターゲット1とターゲット2のハードウェア構成は可能な限り同様にする必要があるため、SQL Server では、提案された変更のパフォーマンスへの影響を正確に分析できます。

注意点 :

- 再生を実行するには、分散再生 (DReplay) トレースを実行するようにコンピューターを設定する必要があります。 詳細については、「[分散再生コントローラーとクライアントのセットアップ](https://blogs.msdn.microsoft.com/datamigration/distributed-replay-controller-and-client-setup/)」を参照してください。
- 移行元サーバーのバックアップを使用して、対象サーバー上のデータベースを復元していることを確認します。
- SQL Server のクエリキャッシュは、評価結果に影響を与える可能性があります。 評価結果の一貫性を向上させるために、サービスアプリケーションで SQL Server サービス (MSSQLSERVER) を再起動することをお勧めします。

トレースファイルを再生するには、次のようにします。

1. DEA で、左側のメニューの 再生 アイコンを選択して、**すべての再生** に移動します。 セッション中に実行される過去の再生の一覧が表示されます (存在する場合)。 新しい再生を開始するには、 **[新しい再生]** を選択します。

1. 次の情報を入力または選択します。

   - **再生名**: 再生トレースのファイル名。
   - **コントローラーコンピューター名**: 分散再生コントローラーコンピューターの名前。
   - **コントローラー上のソーストレースファイルのパス**:[キャプチャ](#capture)からのソーストレースファイルのファイルパス。
   - **SQL Server インスタンス名**: ソーストレースを再生する SQL Server インスタンスの名前。
   - **SQL Server マシンのターゲットトレースファイルを格納するパス**: 結果として生成される再生トレースファイルのフォルダーパス。

1. 最初の手順からバックアップを復元するには、このチェックボックスをオンにします。

1. 再生を開始するには、 **[開始]** を選択します。 

再生の状態を表示できます。 両方の対象サーバーでソーストレースを再生した後、分析レポートを生成する準備ができています。

再生に関してよく寄せられる質問については、再生に関する[FAQ](database-experimentation-assistant-replay-trace.md#frequently-asked-questions-about-trace-replay)を参照してください。

## <a name="analysis"></a>分析

最後の手順は、再生トレースを使用して分析レポートを生成することです。 分析レポートは、提案された変更のパフォーマンスへの影響についての洞察を得るのに役立ちます。

注意点 :

- 1つ以上のコンポーネントが不足している場合は、新しい分析レポートを生成しようとすると (インターネット接続が必要)、[前提条件] ページがダウンロードのリンクと共に表示されます。
- 以前のバージョンのツールで生成されたレポートを表示するには、最初にスキーマを更新する必要があります。

分析レポートを生成するには:

1. 左側のメニューで、 **[分析レポート]** に移動します。 レポートデータベースを格納する SQL Server を実行しているコンピューターに接続します。 サーバー内のすべてのレポートの一覧が表示されます。 新しいレポートを作成するには、 **[新しいレポート]** を選択します。

1. レポートの生成に必要な情報を入力または選択してください:

   - **レポート名**: 作成する分析レポートの名前です。
   - **Target 1 SQL Server のトレース**: ターゲット1での再生によるトレースファイルのパス。
   - **Target 2 SQL Server のトレース**: ターゲット2での再生によるトレースファイルのパス。

1. **[開始]** を選択してレポートを生成します。 新しいレポートが一覧の一番上に表示されます。 レポートが生成されると、レポートの横にあるアイコンが緑色のチェックマークになります。

ここで、A/B テストによって提供される洞察を得るために、分析レポートを表示します。

分析レポートに関してよく寄せられる質問については、「分析に関する[FAQ](database-experimentation-assistant-create-report.md#frequently-asked-questions-about-analysis-reports)」を参照してください。

### <a name="analysis-report"></a>分析レポート

レポートの最初のページには、実験が実行された対象サーバーのバージョンとビルド情報が表示されます。 しきい値を使用すると、A/B テスト分析の感度や許容範囲を調整できます。 既定では、しきい値は5% に設定されています。 5% 以上のパフォーマンスの向上は、**改善**されたものとして分類されます。 別のパフォーマンスしきい値を使用してレポートを評価するには、ドロップダウンメニューの [オプション] を選択します。

![しきい値](https://msdnshared.blob.core.windows.net/media/2017/03/threshold.jpg)

2つの円グラフは、ワークロードの2つの対象サーバーの差によるパフォーマンスへの影響を示しています。 左側のグラフは、実行回数に基づいています。 右側のグラフは、個別のクエリに基づいています。 次の5つのカテゴリがあります。

- **改善**: 統計的には、ターゲット1よりもクエリのパフォーマンスが向上しています。
- **低下**: 統計的には、ターゲット1よりもクエリのパフォーマンスが低下しています。
- **同じ**: target 1 と target 2 の間のクエリには、統計的な違いはありません。
- **評価できません**: クエリのサンプルサイズは、統計分析には小さすぎます。 A/B テスト分析の場合、DEA では、同じクエリに対して、各ターゲットで少なくとも30回の実行が必要です。
- **エラー**: クエリでは、ターゲットの1つで少なくとも1回エラーが発生しています。

![円グラフ](./media/database-experimentation-assistant-get-started/dea-get-started-piechart.png)

スライスを選択して特定のカテゴリにドリルダウンし、パフォーマンスメトリックを取得します。たとえば、[円スライスを**評価できません**] と表示されます。

パフォーマンス変更カテゴリのドリルダウンページには、そのカテゴリのクエリの一覧が表示されます。 **[エラー]** ページには、次の3つのタブがあります。

- **新しいエラー**: ターゲット2に表示されたがターゲット1ではないエラー。
- **[既存のエラー]** : ターゲット1とターゲット2の両方で発生したエラー。
- **解決済みエラー**: ターゲット1に表示されたがターゲット2ではエラーになったエラー。

   ![[エラー] ページ](./media/database-experimentation-assistant-get-started/dea-get-started-errorpage.png)

クエリを選択して、そのクエリの**比較概要**ページにアクセスします。

**[比較の概要]** ページには、そのクエリの概要統計が表示されます。 概要には、実行の数、平均期間、平均 CPU、平均読み取り/書き込み、およびエラー数が含まれます。

![概要統計](./media/database-experimentation-assistant-get-started/dea-get-started-summarystats.png)

クエリがエラークエリの場合、エラーに関する詳細情報が **[エラー情報]** タブに表示されます。 **[クエリプラン情報]** タブには、ターゲット1およびターゲット2でのクエリに使用されるクエリプランに関する情報が表示されます。

![クエリ プラン](./media/database-experimentation-assistant-get-started/dea-get-started-queryplan.png)

分析レポートの任意のページで、右上にある **[印刷]** ボタンを選択して、表示されているすべてのものを印刷します。

## <a name="next-steps"></a>次の手順

- サーバーで発生するイベントのログが記録されたトレースファイルを生成する方法については、「 [Capture trace](database-experimentation-assistant-capture-trace.md)」を参照してください。

- DEA とデモの19分の概要については、次のビデオをご覧ください。

  > [!VIDEO https://channel9.msdn.com/Shows/Data-Exposed/Introducing-the-Database-Experimentation-Assistant/player]
