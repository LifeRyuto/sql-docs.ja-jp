---
title: バックアップと復元 - Parallel Data Warehouse |Microsoft Docs
description: データのバックアップし、復元の並列データ ウェアハウス (PDW) のしくみについて説明します。 バックアップと復元の操作は、ディザスター リカバリーのために使用されます。 バックアップと復元は、1 つのアプライアンスから別のアプライアンスにデータベースをコピーすることも使用できます。
author: mzaman1
ms.prod: sql
ms.technology: data-warehouse
ms.topic: conceptual
ms.date: 01/19/2019
ms.author: murshedz
ms.reviewer: martinle
ms.openlocfilehash: d322eb27a92c644afa834371d5f38b3d9d7ad28b
ms.sourcegitcommit: b2464064c0566590e486a3aafae6d67ce2645cef
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/15/2019
ms.locfileid: "67961404"
---
# <a name="backup-and-restore"></a>バックアップと復元

データのバックアップし、復元の並列データ ウェアハウス (PDW) のしくみについて説明します。 バックアップと復元の操作は、ディザスター リカバリーのために使用されます。 バックアップと復元は、1 つのアプライアンスから別のアプライアンスにデータベースをコピーすることも使用できます。  
    
## <a name="BackupRestoreBasics"></a>バックアップと復元の基礎

PDW*データベースのバックアップ*アプライアンスに、元のデータベースを復元するために使用できるようにの形式で格納されている、アプライアンス データベースのコピーです。  
  
PDW のデータベースのバックアップが作成された、[データベースのバックアップ](../t-sql/statements/backup-database-parallel-data-warehouse.md)t-sql ステートメントとで使用するための書式設定された、[データベースの復元](../t-sql/statements/restore-database-parallel-data-warehouse.md)ステートメントは使用できません、他の目的。 バックアップは、同じ数またはより多くのコンピューティング ノードのアプライアンスにのみ復元できます。  
  
<!-- MISSING LINKS
The [master database](master-database.md) is a SMP SQL Server database. It is backed up with the BACKUP DATABASE statement. To restore master, use the [Restore the Master Database](configuration-manager-restore-master-database.md) page of the Configuration Manager tool.  
-->
  
PDW では、SQL Server のバックアップ テクノロジを使用して、バックアップし、アプライアンス データベースを復元します。 バックアップの圧縮を使用するのには、SQL Server のバックアップ オプションが事前構成済み。 圧縮、チェックサム、ブロック サイズ、バッファー カウントなど、バックアップ オプションを設定することはできません。  
  
1 つまたは複数バックアップ サーバーで、顧客のネットワークに存在するデータベースのバックアップが格納されます。  PDW では、1 つのバックアップ サーバーに並列でコンピューティング ノードから直接ユーザー データベースのバックアップを書き込み、バックアップ サーバーから直接コンピューティング ノードに並列でユーザー データベースのバックアップを復元します。  
  
バックアップは、Windows ファイル システムで、バックアップ サーバーで、一連のファイルとして格納されます。 PDW のデータベースのバックアップは、PDW にのみ復元できます。 ただし、標準の Windows ファイルのバックアップ プロセスを使用して、別の場所にバックアップ サーバーからデータベース バックアップをアーカイブできます。 バックアップ サーバーの詳細については、次を参照してください。[取得し、構成サーバーのバックアップ](acquire-and-configure-backup-server.md)します。  
  
## <a name="BackupTypes"></a>データベースのバックアップの種類

バックアップを必要とするデータの 2 種類があります。 ユーザー データベースやシステム データベース (master データベースなど)。 PDW は、トランザクション ログをバックアップできません。  
  
データベースの完全バックアップでは、PDW データベース全体のバックアップです。 これは、既定のバックアップの種類です。 ユーザー データベースの完全バックアップには、データベース ユーザー、およびデータベース ロールが含まれています。 Master のバックアップには、ログインが含まれています。  
  
差分バックアップには、前回の完全バックアップ以降のすべての変更が含まれます。 通常、差分バックアップは完全バックアップよりも短時間で完了します。完全バックアップよりも頻繁に実行できます。 複数の差分バックアップは、同じ完全バックアップに基づいて、各差分が含まれますすべての変更は、以前の差分には。  
  
たとえば、毎週完全バックアップと差分バックアップを毎日を作成できます。 ユーザー データベース、完全バックアップと最後をリストアするには、差分 (存在する) 場合必要がありますを復元します。  
  
差分バックアップは、ユーザー データベースのみサポートされます。 Master のバックアップは、常に完全バックアップです。  
  
アプライアンス全体をバックアップするには、すべてのユーザー データベースのバックアップと、master データベースのバックアップを実行する必要があります。  
  
## <a name="BackupProc"></a>データベースのバックアップ プロセス

次の図は、データベースのバックアップ中のデータ フローを示します。  
  
![PDW バックアップ プロセス](media/backup-process.png "PDW バックアップ プロセス")  
  
バックアップ プロセスは次のとおりです。  
  
1.  ユーザーは、コントロール ノードに BACKUP DATABASE tsql ステートメントを送信します。  
  
    -   バックアップは、完全バックアップまたは差分バックアップのいずれかです。  
  
2.  ユーザー データベースの場合は、コントロールのノード (MPP エンジン) は、並列データベース バックアップを実行する分散クエリ プランを作成します。  
  
3.  各ノードは、SQL Server バックアップ機能を使用してバックアップ サーバーにそのバックアップ ファイルをバックアップ コピーに関与します。  
  
    -   各ノードには、バックアップ サーバーへのコピー 1 つのバックアップ ファイルが含まれています。  
  
    -   ユーザー データベースのバックアップ (完全または差分) には、各コンピューティング ノードと、データベース ユーザーとデータベース ロールのバックアップに格納されているデータベースの部分のバックアップが含まれています。  
  
4.  アプライアンスは、InfiniBand ネットワークを使用して並列でバックアップを実行します。  
  
    -   PDW では、各完全および差分バックアップを並列で実行します。 ただし、複数のデータベース バックアップが同時に実行しない操作を行います。 各バックアップ要求は、以前に送信されたバックアップを完了を待つ必要があります。  
  
    -   Master データベースのバックアップは制御ノードからのみデータをバックアップします。 このバックアップの種類は直列に実行されます。  
  
5.  PDW のデータベースのバックアップは、アプライアンス オフが存在するディレクトリに格納されたファイルのグループです。 ディレクトリ名は、ネットワーク パスとディレクトリ名として指定されます。 ディレクトリがローカルのパスにすることはできませんし、アプライアンス上にすることはできません。  
  
6.  バックアップが完了すると、必要に応じて、バックアップ ディレクトリを別の場所にコピーするのに、Windows ファイル システムを使用することができます。  
  
    -   バックアップは、コンピューティング ノードの数が同等かそれ以上 PDW アプライアンスにのみ復元できます。  
  
    -   復元を実行する前に、バックアップの名前を変更することはできません。 バックアップ ディレクトリの名前は、バックアップの元の名前の名前と一致する必要があります。 バックアップの元の名前は、バックアップ ディレクトリ内で backup.xml ファイルにあります。 別の名前には、データベースを復元するには、restore コマンドで新しい名前を指定できます。 たとえば、 `RESTORE DATABASE MyDB1 FROM DISK = ꞌ\\10.192.10.10\backups\MyDB2ꞌ`のようにします。  
  
## <a name="RestoreModes"></a>データベースの復元モード

データベース全体の復元は、データベースのバックアップでデータを使用して、PDW のデータベースを再作成します。 データベースの復元は、最初に、完全バックアップを復元して、1 つの差分バックアップを必要に応じて復元によって実行されます。 データベースの復元には、データベース ロール、データベース ユーザーが含まれます。  
  
ヘッダーのみの復元では、データベースのヘッダー情報を返します。 アプライアンスにデータは復元されません。  
  
アプライアンスの復元は、アプライアンス全体の復元です。 これは、すべてのユーザー データベースと master データベースの復元が含まれます。  
  
## <a name="RestoreProc"></a>復元プロセス

次の図は、データベースの復元中のデータ フローを示します。  
  
![復元プロセス](media/restore-process.png "復元プロセス")  
  
## <a name="restoring-to-an-appliance-with-the-same-number-of-compute-nodes"></a>同じ数のコンピューティング ノード * * とアプライアンスへの復元  
  
データを復元するときに、アプライアンスは、ソース アプライアンスと変換先のアプライアンスにコンピューティング ノードの数を検出します。 両方のアプライアンスのコンピューティング ノードの数が等しい場合は、復元プロセスは次のように動作します。  
  
1.  復元するデータベースのバックアップは、非アプライアンス バックアップ サーバー上の Windows ファイル共有で使用できます。 最適なパフォーマンスをこのサーバーは、アプライアンスの InfiniBand ネットワークに接続されます。  
  
2.  ユーザーが送信を[RESTORE DATABASE](../t-sql/statements/restore-database-parallel-data-warehouse.md)コントロール ノードに tsql ステートメント。  
  
    -   復元とは、完全な復元またはヘッダーの復元です。 完全な復元では、完全バックアップが復元され、し、必要に応じて差分バックアップを復元します。  
  
3.  コントロールのノード (MPP エンジン) は、並列データベースの復元を実行する分散クエリ プランを作成します。  
  
    -   SQL ServerPDW は並列でユーザー データベースの復元を実行します。 ただし、複数のデータベースのバックアップと復元はできません同時に実行します。 MPP エンジンは、キューには、各復元ステートメント以前に送信されたバックアップの待機し、復元を完了する要求にする必要があります。  
  
    -   Master データベースの復元がコントロールのノードにのみデータを復元します。復元は直列に実行されます。  
  
    -   ヘッダー情報の復元をクイック操作であり、コンピューティングまたはコントロールのノードにすべてのデータを復元できません。 代わりに、制御ノードは、クエリの出力として結果を返します。  
  
4.  バックアップ ファイルは、アプライアンスの InfiniBand ネットワーク経由で通常を並列に適切なコンピューティング ノードにコピーを取得します。  
  
5.  各コンピューティング ノードでは、ユーザー データベースの部分を復元します。 復元が正常に完了しないと場合のすべてのデータベース削除され、復元が正常に完了します。  
  
## <a name="restoring-to-an-appliance-with-a-larger-number-of-compute-nodes"></a>より多くの計算ノードを備えたアプライアンスへの復元  
  
より多くの計算ノードを備えたアプライアンスにバックアップを復元すると、計算ノードの数に比例して、割り当てられるデータベースのサイズが大きくなります。  
  
などの 6 ノードのアプライアンスを 2 つのノードのアプライアンス (ノードあたり 30 GB) から 60 GB のデータベースを復元する場合、SQL Server PDW は、6 ノード アプライアンス上 180 GB のデータベース (6 ノード 30 GB から 1 つのノード) を作成します。 SQL Server PDW では、ソースの構成と一致する 2 つのノードに最初にデータベースを復元し、し、すべての 6 ノードにデータを再分配します。  
  
再配布した後は、各コンピューティング ノードは実際の低いデータと、小さいソース アプライアンス上の各コンピューティング ノードよりも多くの空き領域を含まれます。 追加の領域を使用して、データベースにデータを追加します。 使用することができます、復元されたデータベースのサイズが、必要以上に大きい場合は、 [ALTER DATABASE](../t-sql/statements/alter-database-transact-sql.md?tabs=sqlpdw)データベース ファイルのサイズを縮小します。  
  
## <a name="related-tasks"></a>Related Tasks  
  
|バックアップと復元タスク|説明|  
|---------------------------|---------------|  
|バックアップ サーバーとして、サーバーを準備します。|[バックアップ サーバーの取得と構成](acquire-and-configure-backup-server.md)|  
|データベースをバックアップします。|[データベースのバックアップ](../t-sql/statements/backup-database-parallel-data-warehouse.md)|  
|データベースを復元します。|[RESTORE DATABASE](../t-sql/statements/restore-database-parallel-data-warehouse.md)|    

<!-- MISSING LINKS

|Create a disaster recovery plan.|[Create a Disaster Recovery Plan](create-disaster-recovery-plan.md)|
|Restore the master database.|To restore the master database, use the [Restore the master database](configuration-manager-restore-master-database.md) page in the Configuration Manager tool.| 
|Copy a database from one appliance to another appliance.|[Copy a PDW database to another appliance](copy-pdw-database-to-another-appliance.md).|  
|Monitor backups and restores.|[Monitor backups and restores](monitor-backup-and-restore.md)|  

-->
