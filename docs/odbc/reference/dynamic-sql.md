---
title: 動的 SQL |マイクロソフトドキュメント
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- SQL [ODBC], embedded SQL
- SQL statements [ODBC], dynamic SQL
- SQL statements [ODBC], embedded SQL
- dynamic SQL [ODBC]
- SQL [ODBC], dynamic SQL
- embedded SQL [ODBC]
ms.assetid: 0bfb9ab7-9c15-4433-93bc-bad8b6c9d287
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 56419723540114f122be2582f0de7c7e7d0c54f3
ms.sourcegitcommit: ce94c2ad7a50945481172782c270b5b0206e61de
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/14/2020
ms.locfileid: "81306690"
---
# <a name="dynamic-sql"></a>動的 SQL
静的 SQL は多くの状況でうまく機能しますが、データ アクセスを事前に決定できないアプリケーションのクラスがあります。 たとえば、スプレッドシートでユーザーがクエリを入力でき、その後、スプレッドシートが DBMS に送信してデータを取得するとします。 このクエリの内容は、スプレッドシート プログラムが書かれているときにプログラマに明らかに知ることはできません。  
  
 この問題を解決するために、スプレッドシートは動的 SQL と呼ばれる組み込み SQL の形式を使用します。 プログラム内でハードコーディングされる静的 SQL ステートメントとは異なり、動的 SQL ステートメントは実行時に作成され、ストリング・ホスト変数に入れることができます。 その後、処理のために DBMS に送信されます。 DBMS は動的 SQL ステートメントの実行時にアクセス・プランを生成する必要があるため、動的 SQL は通常、静的 SQL よりも低速です。 動的 SQL ステートメントを含むプログラムがコンパイルされる場合、静的 SQL のように動的 SQL ステートメントは除去されません。 代わりに、ステートメントを DBMS に渡す関数呼び出しに置き換えられます。同じプログラム内の静的 SQL ステートメントは、通常どおりに扱われます。  
  
 動的 SQL ステートメントを実行する最も簡単な方法は、EXECUTE IMMEDIATE ステートメントを使用することです。 このステートメントは、コンパイルと実行のために SQL ステートメントを DBMS に渡します。  
  
 EXECUTE IMMEDIATE ステートメントの欠点の 1 つは、ステートメントが実行されるたびに、DBMS が SQL ステートメントを処理する 5 つのステップのそれぞれを実行する必要がある点です。 このプロセスに伴うオーバーヘッドは、多数のステートメントが動的に実行される場合に大きな負荷になる可能性があり、それらのステートメントが類似している場合は無駄です。 この状況に対処するために、動的 SQL は、次のステップを使用する準備実行と呼ばれる最適化された形式の実行を提供します。  
  
1.  このプログラムは、EXECUTE IMMEDIATE ステートメントの場合と同様に、バッファー内に SQL ステートメントを作成します。 ホスト変数の代わりに、ステートメント テキスト内の任意の場所で疑問符 (?) を置き換えて、定数の値を後で指定することを示すことができます。 疑問符はパラメータマーカーとして呼ばれます。  
  
2.  プログラムは、SQL ステートメントを PREPARE ステートメントを使用して DBMS に渡します。 その後、プログラムは EXECUTE ステートメント (EXECUTE IMMEDIATE ステートメントではない) を使用して、後で PREPARE ステートメントを実行します。 SQL データ域または SQLDA と呼ばれる特殊なデータ構造を介して、ステートメントのパラメーター値を渡します。  
  
3.  プログラムは EXECUTE ステートメントを繰り返し使用し、動的ステートメントが実行されるたびに異なるパラメーター値を指定できます。  
  
 準備された実行は、静的 SQL と同じではありません。 静的 SQL では、SQL ステートメントを処理する最初の 4 つのステップはコンパイル時に行われます。 準備実行では、これらのステップは実行時に実行されますが、実行されるのは 1 回だけです。プランの実行は、EXECUTE が呼び出された場合にのみ実行されます。 これにより、動的 SQL のアーキテクチャに固有のパフォーマンス上の欠点を排除できます。 次の図は、静的 SQL、即時実行を伴う動的 SQL、および準備された実行を伴う動的 SQL の違いを示しています。
