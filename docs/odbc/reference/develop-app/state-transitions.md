---
title: 状態遷移 |マイクロソフトドキュメント
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- state transitions [ODBC]
- unallocated state [ODBC]
- handles [ODBC], state transitions
- allocated state [ODBC]
- connection state [ODBC]
ms.assetid: fc741611-6535-43cc-8156-6d897d04664e
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 3a480b7ff8953ef94f0efc4886a09731730a61b7
ms.sourcegitcommit: ce94c2ad7a50945481172782c270b5b0206e61de
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/14/2020
ms.locfileid: "81299695"
---
# <a name="state-transitions"></a>状態遷移
ODBC では、環境、各接続、およびステートメントごとに個別*の状態*が定義されます。 たとえば、環境には、未割り当て (環境が割り当てられていない)、割り当て済み (環境が割り当てられているが接続が割り当てられていない)、および接続 (環境と 1 つ以上の接続が割り当てられる) の 3 つの状態が考えられます。 接続には 7 つの状態があります。ステートメントには 13 の可能な状態があります。  
  
 特定の項目は、そのハンドルによって識別されるように、アプリケーションが特定の関数を呼び出し、その項目にハンドルを渡すと、ある状態から別の状態に移動します。 このような動きを*状態遷移*と呼んでいます。 たとえば **、SQLAllocHandle**を使用して環境ハンドルを割り当てると、環境が未割り当てから割り当て済みへ移動し **、SQLFreeHandle**でそのハンドルを解放すると、割り当てから未割り当てに戻ります。 ODBC は、限定的な数の有効な状態遷移を定義しますが、これは関数を特定の順序で呼び出さなければならないというもう 1 つの方法です。  
  
 **SQLGetConnectAttr**などの一部の関数は、状態にまったく影響しません。 その他の関数は、単一の項目の状態に影響します。 たとえば **、SQLDisconnect は**接続状態から割り当て済み状態に接続を移動します。 最後に、一部の関数は、複数の項目の状態に影響します。 たとえば、接続ハンドルを**SQLAllocHandle**で割り当てると、接続が未割り当て状態から割り当て済み状態に移動し、環境が割り当て済み状態から接続状態に移動します。  
  
 アプリケーションが関数を誤って呼び出した場合、この関数は*状態遷移エラー*を返します。 たとえば、環境が接続状態で、アプリケーションがその環境ハンドルを使用して**SQLFreeHandle**を呼び出す場合 **、SQLFreeHandle**は、環境が割り当て済み状態の場合にのみ呼び出すことができるため、SQLState HY010 (関数シーケンス エラー) を返します。 これを無効な状態遷移として定義することにより、ODBC はアクティブな接続がある間、アプリケーションが環境を解放することを防ぎます。  
  
 一部の状態遷移は、ODBC の設計に固有です。 たとえば、接続ハンドルを割り当てる関数には環境ハンドルが必要なため、まず環境ハンドルを割り当てなければ接続ハンドルを割り当てることは不可能です。 その他の状態遷移は、ドライバー マネージャーとドライバーによって強制されます。 たとえば **、SQLExecute は**、準備されたステートメントを実行します。 渡されたステートメント・ハンドルが準備済み状態でない場合 **、SQLExecute**は SQLSTATE HY010 (関数シーケンス・エラー) を戻します。  
  
 アプリケーションの観点から見ると、状態遷移は通常簡単です: 法的状態遷移は、適切に記述されたアプリケーションのフローと手をつないで行く傾向があります。 状態遷移は、環境、各接続、および各ステートメントの状態を追跡する必要があるため、ドライバー マネージャーとドライバーの複雑です。 この作業のほとんどは、ドライバー マネージャーによって行われます。ドライバーが行う必要がある作業のほとんどは、保留中の結果を含むステートメントで発生します。  
  
 このマニュアルのパート 1 と 2 (「ODBC の概要」と「アプリケーションとドライバーの開発」) は、状態遷移について明示的に言及しない傾向があります。 代わりに、関数を呼び出す順序を記述します。 たとえば、"ステートメントの実行" は **、SQLExecute**を使用して実行する前に **、SQLPrepare**を使用してステートメントを準備する必要があることを示しています。 ドライバー マネージャーによってチェックされる遷移やドライバーによってチェックする必要がある遷移など、状態と状態の遷移の詳細については、「[付録 B: ODBC 状態遷移の表](../../../odbc/reference/appendixes/appendix-b-odbc-state-transition-tables.md)」を参照してください。
