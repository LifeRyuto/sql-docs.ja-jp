---
title: オプティミスティック同時実行制御 |マイクロソフトドキュメント
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- transactions [ODBC], concurrency control
- concurrency control [ODBC]
- optimistic concurrency [ODBC]
ms.assetid: 9d71e09e-bc68-4c1f-9229-ed2a7be7d324
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 30eba3ea03b4c798a74a8cb928014b582846607b
ms.sourcegitcommit: ce94c2ad7a50945481172782c270b5b0206e61de
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/14/2020
ms.locfileid: "81282489"
---
# <a name="optimistic-concurrency"></a>オプティミスティック コンカレンシー
*オプティミスティック同時実行制御*は、トランザクション間の競合が発生することはめったにないというオプティミスティックな仮定から名前を導き出します。競合は、現在のトランザクションが読み取られた時点から、データが更新または削除された時点までの間に、別のトランザクションがデータ行を更新または削除したときに発生したと言われます。 これは、アプリケーション開発者がこのような衝突が一般的であると考える*ペシミスティック同時実行制御*(ロック)の反対です。  
  
 オプティミスティック同時実行制御では、更新または削除の時間が来るまで、行はロック解除されたままです。 その時点で、行は再読み込みされ、最後に読み取られた後に変更されたかどうかがチェックされます。 行が変更された場合、更新または削除は失敗し、再試行する必要があります。  
  
 行が変更されたかどうかを確認するために、その新しいバージョンがキャッシュされたバージョンの行と照合されます。 このチェックは、SQL Server のタイムスタンプ列などの行のバージョン、または行の各列の値に基づいて行うことができます。 多くの DBMS では、行バージョンはサポートされていません。  
  
 オプティミスティック同時実行制御は、データ ソースまたはアプリケーションによって実装できます。 どちらの場合も、アプリケーションは、コミットの読み取りなどの低いトランザクション分離レベルを使用する必要があります。高いレベルを使用すると、オプティミスティック同時実行制御を使用して得られる同時実行制御の増加が否定されます。  
  
 オプティミスティック同時実行制御がデータ ソースによって実装されている場合、アプリケーションはSQL_ATTR_CONCURRENCY ステートメント属性をSQL_CONCUR_ROWVERまたはSQL_CONCUR_VALUESに設定します。 行を更新または削除するには、ペシミスティック同時実行制御と同じように、位置指定された更新または削除ステートメントを実行するか **、SQLSetPos**を呼び出します。ドライバーまたはデータ ソースは、更新または競合が原因で削除が失敗した場合、SQLSTATE 01001 (カーソル操作の競合) を返します。  
  
 アプリケーション自体がオプティミスティック同時実行制御を実装している場合、SQL_ATTR_CONCURRENCYステートメント属性をSQL_CONCUR_READ_ONLYに設定して行を読み取ります。 行のバージョンを比較し、行バージョン列がわからない場合は、この列の名前を決定するSQL_ROWVERオプションを指定して**SQLSpecialColumns**を呼び出します。  
  
 アプリケーションは、SQL_CONCUR_LOCK 行を読み取ったときに行のバージョンまたは値を指定する**WHERE**句を指定して**UPDATE**または**DELETE**ステートメントを実行して、行を更新または削除します。 その後行が変更された場合、ステートメントは失敗します。 **WHERE**句が行を一意に識別しない場合、ステートメントは他の行を更新または削除することもあります。行バージョンは常に行を一意に識別しますが、行の値は主キーが含まれている場合にのみ行を一意に識別します。
