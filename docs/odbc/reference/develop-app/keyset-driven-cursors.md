---
title: キーセット駆動カーソル |マイクロソフトドキュメント
ms.custom: ''
ms.date: 01/19/2017
ms.prod: sql
ms.prod_service: connectivity
ms.reviewer: ''
ms.technology: connectivity
ms.topic: conceptual
helpviewer_keywords:
- keyset-driven cursors [ODBC]
- cursors [ODBC], key-set driven
ms.assetid: 01769f43-1d9c-4685-84fa-15a6465335e9
author: David-Engel
ms.author: v-daenge
ms.openlocfilehash: 814fca7d48f50aab51b6b4f7e34835be8c412e9c
ms.sourcegitcommit: ce94c2ad7a50945481172782c270b5b0206e61de
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/14/2020
ms.locfileid: "81306207"
---
# <a name="keyset-driven-cursors"></a>キーセット ドリブン カーソル
キーセット ドリブン カーソルは、静的カーソルと動的カーソルの間にあり、変更を検出する機能を備えています。 静的カーソルと同様に、結果セットのメンバーシップと順序に対する変更は常に検出されません。 動的カーソルと同様に、結果セット内の行の値に対する変更を検出します (SQL_ATTR_TXN_ISOLATION接続属性で設定されたトランザクションの分離レベルに従います)。  
  
 キーセット ドリブン カーソルを開くと、結果セット全体のキーが保存されます。これにより、結果セットの明らかなメンバーシップと順序が修正されます。 カーソルが結果セットをスクロールするときに、この*キーセット*のキーを使用して各行の現在のデータ値を取得します。 たとえば、キーセット ドリブン カーソルが行をフェッチし、別のアプリケーションがその行を更新するとします。 カーソルが行を再フェッチする場合、そのキーを使用して行を再フェッチしたため、カーソルが見る値は新しい値になります。 このため、キーセット ドリブン カーソルは常に自分自身や他のユーザーが行った変更を検出します。  
  
 カーソルが削除された行を取得しようとすると、この行は結果セットに「穴」として表示されます: 行のキーはキーセットに存在しますが、その行は結果セットに存在しません。 行のキー値が更新されると、その行は削除されてから挿入されたと見なされるため、そのような行は結果セットの穴としても表示されます。 キーセット ドリブン カーソルは、他のユーザーが削除した行を常に検出できますが、キーセットから削除した行のキーを削除することもできます。 これを行うキーセット ドリブン カーソルは、自身の削除を検出できません。 特定のキーセット ドリブン カーソルがそれ自体の削除を検出するかどうかは **、 SQLGetInfo**の SQL_STATIC_SENSITIVITY オプションを使用して報告されます。  
  
 他の行によって挿入された行は、キーセットにキーセットにキーが存在しないため、キーセット ドリブン カーソルには表示されません。 ただし、キーセット ドリブン カーソルは、キーセットに挿入する行のキーをオプションで追加できます。 これを行うキーセットドリブン カーソルは、独自の挿入を検出できます。 特定のキーセット ドリブン カーソルが独自の挿入を検出するかどうかは **、 SQLGetInfo**の SQL_STATIC_SENSITIVITY オプションを使用して報告されます。  
  
 SQL_ATTR_ROW_STATUS_PTR ステートメント属性で指定された行の状態配列には、任意の行のSQL_ROW_SUCCESS、SQL_ROW_SUCCESS_WITH_INFO、またはSQL_ROW_ERRORを含めることができます。 更新、削除、または挿入済みとして検出された行のSQL_ROW_UPDATED、SQL_ROW_DELETED、またはSQL_ROW_ADDEDを返します。  
  
 通常、キーセット ドリブン カーソルは、結果セット内の各行のキーを含む一時テーブルを作成することによって実装されます。 カーソルは行が更新されたかどうかも判別する必要があるため、この表には行のバージョン管理情報を含む列も含まれます。  
  
 元の結果セットをスクロールするには、キーセットドリブン カーソルは一時テーブル上に静的カーソルを開きます。 元の結果セットの行を取得するには、カーソルはまず一時テーブルから適切なキーを取得し、次に行の現在の値を取得します。 ブロックカーソルを使用する場合、カーソルは複数のキーと行を取得する必要があります。
